---
title: "Chart Topping Songs Have Gotten More Depressing Over Time"
author: ''
date: '2018-10-09'
output:
  html_document:
    df_print: paged
slug: popular-music-is-getting-more-depressing-over-time
tags: []
categories: []
---

```{r results='asis', echo=FALSE, include=FALSE,}
library(dplyr)
library(ggplot2)
library(hrbrthemes)
library(plotly)
library(highcharter)
library(moderndive)

load("C:/Users/nyulo/Documents/R/blogg/tracks_subset")
```


```{r, echo = FALSE, warning=FALSE, message = FALSE}

lm <- lm(valence ~ release_year, data = tracks_subset)

avg_line <- get_regression_points(lm) %>% 
  rename(x = release_year, y = valence_hat) %>% 
  select(x,y)

tracks2 <- tracks_subset %>% 
  filter(!is.na(release_year)) %>% 
  mutate(decade = release_year - release_year %% 10) %>%
  rowwise %>% 
  mutate(tooltip = paste0('<b>Artist:</b> ', artist_name,
                          '<br><b>Track:</b> ', track_name,
                          '<br><b>Album:</b> ', album_name,
                          '<br><b>Valence:</b> ', valence)
         ) %>% ungroup()

hchart(tracks2, 'scatter', hcaes(x = release_year, y = valence)) %>% 
  hc_tooltip(formatter = JS(paste0("function() {return this.point.tooltip;}")), useHTML = T) %>% 
  hc_add_series(data = avg_line, type = 'line', color = 'black') %>%
  hc_colors('lightgrey') %>%
  hc_xAxis(max = 2018, min = 1960, title = list(text = '')) %>% 
  hc_yAxis(max = 1, title = list(text = 'Valence')) %>% 
  hc_title(text = 'Song Valence Over Time') %>% 
  hc_subtitle(text = '(1960 - 2018)') %>% 
  hc_add_theme(hc_theme_smpl())


```
\newline
\newline

## How can we determine how positive or negative a song is?

Spotify offers information on various song metrics via its API. We're interested in one called "valence", and While they don't disclose the components of how it's calculated, it's described as:

>A measure from 0.0 to 1.0 describing the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g. sad, depressed, angry).

\newline
The standard for popular music in the US is the Billboard Hot 100, and we'll be considering each #1 track from 1960 to present day. You can hover over any point to show the song / artist / album name, along with its associated valence score:

For the statistically minded, the relationship is highly significant:

```{r, message = FALSE, warning = FALSE}
library(stargazer)
lm <- lm(valence ~ release_year, data = tracks_subset)
summary(lm)

```


More detail can be seen when we consider decade level distributions:


```{r, warning=FALSE, message = FALSE}


  p1 <- tracks_subset %>%
    select(track_name, valence, release_year) %>% 
    mutate(decade = release_year - release_year %% 10) %>%
    filter(!is.na(decade)) %>% 
    ggplot(aes(valence)) + 
    geom_density() +
    facet_wrap(~decade) +
    theme_ipsum_rc() + 
    theme(panel.grid = element_blank()) +
    labs(title = "Chart-topper Valence By Decade",
         subtitle = '1960 to Present')
  
  p1


```

Some thoughts:

* Are we being supplied music that is less cheerful, or are we demanding music that is less cheerful?

* 

